<div class="roi-summary-job">
    <h3 class="panel-title">%%ROI.Summary%%</h3>
    <div data-bind="visible: !loading() && !hasRoiData() && !hideInstructionsMessage()">
        <div class="form-group">
            <label>%%Hourly.Cost%%</label>
            <input type="number" data-bind="value: graphOptions().hourlyCost" class="form-control input-sm"
                   aria-label="Hourly cost rate" min="0" step="0.01" />
        </div>
        <div class="form-group">
            <label>%%Last.Howmany.Days%%</label>
            <div class="input-group">
                <input type="number" data-bind="value: graphOptions().queryMax" class="form-control input-sm" min="1"
                       step="1" pattern="\d*" title="Please enter a positive whole number"
                       onkeypress="return event.charCode >= 48 && event.charCode <= 57" />
                <span class="input-group-addon" data-bind="text: getMessage('Days')"></span>
            </div>
        </div>
    </div>

    <!-- Loading indicator -->
    <div data-bind="visible: loading()" class="text-center">
        <i class="glyphicon glyphicon-refresh fa-spin"></i>%%Loading%%
    </div>

    <!-- No ROI Data message -->
    <div data-bind="visible: !loading() && !hasRoiData() && !hideInstructionsMessage()" class="alert alert-info"
         style="display: flex; align-items: start;">
        <div style="flex: 1;">
            <div style="display: flex; justify-content: space-between; align-items:center; margin-bottom: 15px;">
                <h4 class="alert-heading" style="margin-bottom:0; display: inline-flex; gap:5px;">
                    <i class="glyphicon glyphicon-info-sign"></i> <span data-bind="text: getMessage('No.ROI.Data.Available')"></span>
                </h4>
                <button class="close" aria-label="Do not show this message" title="Do not show this message" data-bind="click: hideInstructions">
                    X
                </button>
            </div>
            <p><b data-bind="text: getMessage('Increase.Days.Message')"></b></p>

            <p data-bind="text: getMessage('No.ROI.Metrics.Configured')"></p>
            <ol>
                <li><span data-bind="text: getMessage('Go.To.Job.Editor')"></span> <strong data-bind="text: getMessage('Execution.Plugins')"></strong> <span data-bind="text: getMessage('Tab.Tab')"></span></li>
                <li><span data-bind="text: getMessage('Enable.ROI.Metrics')"></span> <strong data-bind="text: getMessage('ROI.Metrics.Data')"></strong> <span data-bind="text: getMessage('Plugin')"></span></li>
                <li><span data-bind="text: getMessage('Add')"></span> <strong data-bind="text: getMessage('Add.Custom.Field')"></strong> <span data-bind="text: getMessage('Create.Field')"></span>
                    <ul style="list-style-type: none; padding-left: 20px; margin-top: 10px;">
                        <li>• <span data-bind="text: getMessage('Field.Label')"></span> "<span data-bind="text: getMessage('Hours.Saved')"></span>" <span data-bind="text: getMessage('Or.Similar')"></span></li>
                        <li>• <span data-bind="text: getMessage('Field.Key')"></span> <code>hours</code></li>
                        <li>• <span data-bind="text: getMessage('Description')"></span> <span data-bind="text: getMessage('Brief.Explanation')"></span></li>
                    </ul>
                </li>
                <li data-bind="text: getMessage('Enter.Value')"></li>
                <li data-bind="text: getMessage('Save.Job')"></li>
            </ol>
            <p><span data-bind="text: getMessage('Once.Configured')"></span>
                <a href="https://docs.rundeck.com/docs/manual/jobs/roi-metrics.html" target="_blank"><span data-bind="text: getMessage('Learn.More')"></span>
                    <i class="glyphicon glyphicon-new-window"></i>
                </a>
            </p>
        </div>
    </div>

    <p class="no-metrics" data-bind="visible: !loading() && !hasRoiData() && hideInstructionsMessage()">
        %%Not.Configured%%
    </p>

    <!-- ROI Data section -->
    <div data-bind="visible: !loading() && hasRoiData()">
        <div class="roi-summary-cards">
            <div class="row">
                <!-- Total Executions Card -->
                <div class="col-md-3">
                    <div class="roi-card">
                        <div class="roi-card-content">
                            <div class="roi-metric-value" data-bind="text: total"></div>
                            <div class="roi-metric-label" data-bind="text: getMessage('Total.Executions')"></div>
                        </div>
                    </div>
                </div>
                <!-- Average Hours Card -->
                <div class="col-md-3">
                    <div class="roi-card">
                        <div class="roi-card-content">
                            <div class="roi-metric-value" data-bind="text: jobRoiPerUnitTotal().toFixed(2)"></div>
                            <div class="roi-metric-label" data-bind="text: getMessage('Average.Hours.Saved')"></div>
                        </div>
                    </div>
                </div>
                <!-- Total Hours Card -->
                <div class="col-md-3">
                    <div class="roi-card">
                        <div class="roi-card-content">
                            <div class="roi-metric-value" data-bind="text: (jobRoiPerUnitTotal() * total()).toFixed(2)">
                            </div>
                            <div class="roi-metric-label" data-bind="text: getMessage('Total.Hours.Saved')"></div>
                        </div>
                    </div>
                </div>
                <!-- Value Card -->
                <div class="col-md-3">
                    <div class="roi-card">
                        <div class="roi-card-content">
                            <div class="roi-metric-value" data-bind="text: roiCalculation"></div>
                            <div class="roi-metric-label" data-bind="text: getMessage('Value')"></div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Chart container with more controlled size -->
<div class="roi-chart-container" data-bind="visible: !loading() && hasRoiData()">
    <div class="roi-chart-wrapper">
        <div style="width: 80%; height: 400px; margin: auto;">
            <canvas id="roiTrendChart"></canvas>
        </div>
    </div>
</div>

<div data-bind="visible: !loading() && hasRoiData()">
    <h5 data-bind="text: getMessage('Graph.Information')"></h5>
    <ul class="list-unstyled">
        <li><i class="glyphicon glyphicon-info-sign"></i> <span data-bind="text: getMessage('Data.Points')"></span></li>
        <li><i class="glyphicon glyphicon-info-sign"></i> <span data-bind="text: getMessage('Multiple.Executions')"></span></li>
        <li><i class="glyphicon glyphicon-hand-up"></i> <span data-bind="text: getMessage('Hover.Over')"></span>
            <ul>
                <li data-bind="text: getMessage('Total.Number.Executions')"></li>
                <li data-bind="text: getMessage('Total.Hours.Saved.Day')"></li>
                <li data-bind="text: getMessage('Average.Hours.Execution')"></li>
            </ul>
        </li>
    </ul>
</div>